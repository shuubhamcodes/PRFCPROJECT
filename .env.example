# ========================================
# IoT Resilience PRFC Lab - Environment Configuration
# ========================================
# Copy this file to .env and adjust values as needed

# ========================================
# SUPABASE CONFIGURATION (Dashboard only)
# ========================================
VITE_SUPABASE_URL=your_supabase_url_here
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key_here

# ========================================
# ROUTING CONFIGURATION
# ========================================

# Routing mode: 'physical' or 'virtual'
# - physical: Routes through n1->n2->n3 physical servers only (baseline mode)
# - virtual: Routes through 24-node virtual topology with graph-based path selection (PRFC mode)
ROUTING_MODE=virtual

# K_PATHS: Number of candidate paths to compute during path discovery
# Range: 3-10
# Higher values provide more alternatives but increase computation
# Default: 5
K_PATHS=5

# ACTIVE_PATHS: Number of paths to use simultaneously for load distribution
# Range: 1-5
# 1 = single path (no redundancy)
# 3 = primary + 2 backups (recommended)
# 5 = maximum redundancy
# Default: 3
ACTIVE_PATHS=3

# ========================================
# PRFC (Predictive Resilience) THRESHOLDS
# ========================================

# PRFC_EWMA_THRESHOLD: Maximum acceptable EWMA (Exponential Weighted Moving Average) latency
# Unit: milliseconds
# Paths exceeding this threshold are considered degraded (when slope also exceeds threshold)
# Typical values:
#   - Low latency requirement: 50-80ms
#   - Normal operation: 100-150ms
#   - Relaxed: 200-300ms
# Default: 100
PRFC_EWMA_THRESHOLD=100

# PRFC_SLOPE_THRESHOLD: Minimum latency trend indicating degradation
# Unit: ms/batch
# Positive slopes indicate increasing latency over time (trending worse)
# Negative slopes indicate decreasing latency (trending better)
# Typical values:
#   - Aggressive detection: 2-3 ms/batch
#   - Balanced: 5-7 ms/batch
#   - Conservative: 10-15 ms/batch
# Default: 5
PRFC_SLOPE_THRESHOLD=5

# RECOVERY_HOLD_TIME: Time to wait before path enters recovery state
# Unit: milliseconds
# Prevents premature recovery during temporary improvements
# Path must show improvement for this duration before entering "recovering" state
# Typical values:
#   - Fast recovery: 10000-15000ms (10-15 seconds)
#   - Balanced: 20000-25000ms (20-25 seconds)
#   - Conservative: 30000-40000ms (30-40 seconds)
# Default: 20000
RECOVERY_HOLD_TIME=20000

# STABILITY_TIME: Time path must remain stable before returning to healthy
# Unit: milliseconds
# After entering recovery, path must remain stable for this duration before marked as healthy
# Typical values:
#   - Fast: 10000ms (10 seconds)
#   - Balanced: 15000ms (15 seconds)
#   - Conservative: 20000ms (20 seconds)
# Default: 15000
STABILITY_TIME=15000

# TRANSITION_DURATION: Duration for gradual revert to optimal distribution
# Unit: milliseconds
# When paths recover, load is gradually shifted back over this period
# Prevents thundering herd effects and connection storms
# Typical values:
#   - Fast transition: 5000ms (5 seconds)
#   - Balanced: 7000ms (7 seconds)
#   - Smooth transition: 10000ms (10 seconds)
# Default: 7000
TRANSITION_DURATION=7000

# ========================================
# ADDITIONAL PRFC PARAMETERS
# ========================================

# PRFC_WINDOW_SIZE: Number of batches to consider for EWMA/slope calculation
# Default: 10
PRFC_WINDOW_SIZE=10

# PRFC_ALPHA: EWMA smoothing factor (0-1)
# Lower = more smoothing, higher = more responsive
# Default: 0.3
PRFC_ALPHA=0.3

# EWMA_MAX_MS: Alias for PRFC_EWMA_THRESHOLD
# Default: 100
EWMA_MAX_MS=100

# SLOPE_MIN_MS_PER_S: Alias for PRFC_SLOPE_THRESHOLD
# Default: 5
SLOPE_MIN_MS_PER_S=5

# HOLD_SEC: Initial failover hold time (seconds)
# Default: 3
HOLD_SEC=3

# ========================================
# RESOURCE THRESHOLDS
# ========================================

# CPU_MAX: Maximum CPU utilization before node is marked unhealthy
# Range: 0.0-1.0 (0.85 = 85%)
# Default: 0.85
CPU_MAX=0.85

# BUF_MAX_PCT: Maximum buffer utilization before node is marked unhealthy
# Range: 0.0-1.0 (0.8 = 80%)
# Default: 0.8
BUF_MAX_PCT=0.8

# ========================================
# SERVER CONFIGURATION
# ========================================

# Gateway (PRFC Controller)
GATEWAY_PORT=4000

# Edge Server (Physical node 1, Virtual nodes 1-8)
EDGE_SERVER_URL=http://localhost:4020
EDGE_PORT=4020

# Core Server (Physical node 2, Virtual nodes 9-18, 22)
CORE_SERVER_URL=http://localhost:4025
CORE_PORT=4025

# Cloud Server (Physical node 3, Virtual nodes 19-21, 23-24)
CLOUD_SERVER_URL=http://localhost:4030
CLOUD_PORT=4030

# ========================================
# SIMULATOR CONFIGURATION
# ========================================

# GATEWAY_INGEST: Gateway ingestion endpoint
GATEWAY_INGEST=http://localhost:4000/ingest

# MACHINES: Number of simulated IoT devices
MACHINES=10

# EPS: Events per second (per device)
EPS=5

# DURATION_SEC: Simulation duration in seconds
DURATION_SEC=300

# PLACEMENT: Device placement tier
# Options: edge, fog, cloud
PLACEMENT=edge

# ========================================
# FAULT INJECTION CONFIGURATION
# ========================================

# FAULT_KIND: Type of fault to inject
# Options: none, cpu_overload, node_crash, bw_drop, dp_spike, loss_burst, disk_stall, virtual_node
FAULT_KIND=none

# FAULT_TARGET: Node or link to target
# Physical nodes: n1, n2, n3
# Virtual nodes: 1-24
# Links: L12, L13, L23
FAULT_TARGET=n1

# FAULT_START_SEC: When to start fault injection (seconds from start)
FAULT_START_SEC=120

# FAULT_DURATION_SEC: How long fault lasts
FAULT_DURATION_SEC=60

# FAULT_SEVERITY: Fault intensity
# Options: low, medium, high
FAULT_SEVERITY=medium

# ========================================
# DATASET CONFIGURATION
# ========================================

# DATASET_SOURCE: Data source for simulator
# Options: synthetic, csv
DATASET_SOURCE=synthetic

# CSV_PATH: Path to CSV file for replay (if DATASET_SOURCE=csv)
CSV_PATH=./data/replay.csv
